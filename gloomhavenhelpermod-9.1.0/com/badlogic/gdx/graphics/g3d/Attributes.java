package com.badlogic.gdx.graphics.g3d;

import com.badlogic.gdx.utils.Array;
import java.util.Comparator;
import java.util.Iterator;

public class Attributes implements Iterable, Comparator, Comparable {
   protected long mask;
   protected final Array attributes = new Array();
   protected boolean sorted = true;

   public final void sort() {
      if (!this.sorted) {
         this.attributes.sort(this);
         this.sorted = true;
      }
   }

   public final long getMask() {
      return this.mask;
   }

   public final Attribute get(long type) {
      if (this.has(type)) {
         for (int i = 0; i < this.attributes.size; i++) {
            if (((Attribute)this.attributes.get(i)).type == type) {
               return (Attribute)this.attributes.get(i);
            }
         }
      }

      return null;
   }

   public final Attribute get(Class clazz, long type) {
      return this.get(type);
   }

   public final Array get(Array out, long type) {
      for (int i = 0; i < this.attributes.size; i++) {
         if ((((Attribute)this.attributes.get(i)).type & type) != 0L) {
            out.add(this.attributes.get(i));
         }
      }

      return out;
   }

   public void clear() {
      this.mask = 0L;
      this.attributes.clear();
   }

   public int size() {
      return this.attributes.size;
   }

   private final void enable(long mask) {
      this.mask |= mask;
   }

   private final void disable(long mask) {
      this.mask &= ~mask;
   }

   public final void set(Attribute attribute) {
      int idx = this.indexOf(attribute.type);
      if (idx < 0) {
         this.enable(attribute.type);
         this.attributes.add(attribute);
         this.sorted = false;
      } else {
         this.attributes.set(idx, attribute);
      }

      this.sort();
   }

   public final void set(Attribute attribute1, Attribute attribute2) {
      this.set(attribute1);
      this.set(attribute2);
   }

   public final void set(Attribute attribute1, Attribute attribute2, Attribute attribute3) {
      this.set(attribute1);
      this.set(attribute2);
      this.set(attribute3);
   }

   public final void set(Attribute attribute1, Attribute attribute2, Attribute attribute3, Attribute attribute4) {
      this.set(attribute1);
      this.set(attribute2);
      this.set(attribute3);
      this.set(attribute4);
   }

   public final void set(Attribute... attributes) {
      for (Attribute attr : attributes) {
         this.set(attr);
      }
   }

   public final void set(Iterable attributes) {
      for (Attribute attr : attributes) {
         this.set(attr);
      }
   }

   public final void remove(long mask) {
      for (int i = this.attributes.size - 1; i >= 0; i--) {
         long type = ((Attribute)this.attributes.get(i)).type;
         if ((mask & type) == type) {
            this.attributes.removeIndex(i);
            this.disable(type);
            this.sorted = false;
         }
      }

      this.sort();
   }

   public final boolean has(long type) {
      return type != 0L && (this.mask & type) == type;
   }

   protected int indexOf(long type) {
      if (this.has(type)) {
         for (int i = 0; i < this.attributes.size; i++) {
            if (((Attribute)this.attributes.get(i)).type == type) {
               return i;
            }
         }
      }

      return -1;
   }

   public final boolean same(Attributes other, boolean compareValues) {
      if (other == this) {
         return true;
      } else if (other != null && this.mask == other.mask) {
         if (!compareValues) {
            return true;
         } else {
            this.sort();
            other.sort();

            for (int i = 0; i < this.attributes.size; i++) {
               if (!((Attribute)this.attributes.get(i)).equals((Attribute)other.attributes.get(i))) {
                  return false;
               }
            }

            return true;
         }
      } else {
         return false;
      }
   }

   public final boolean same(Attributes other) {
      return this.same(other, false);
   }

   public final int compare(Attribute arg0, Attribute arg1) {
      return (int)(arg0.type - arg1.type);
   }

   @Override
   public final Iterator iterator() {
      return this.attributes.iterator();
   }

   public int attributesHash() {
      this.sort();
      int n = this.attributes.size;
      long result = 71L + this.mask;
      int m = 1;

      for (int i = 0; i < n; i++) {
         result += this.mask * ((Attribute)this.attributes.get(i)).hashCode() * (m = m * 7 & 65535);
      }

      return (int)(result ^ result >> 32);
   }

   @Override
   public int hashCode() {
      return this.attributesHash();
   }

   @Override
   public boolean equals(Object other) {
      if (!(other instanceof Attributes)) {
         return false;
      } else {
         return other == this ? true : this.same((Attributes)other, true);
      }
   }

   public int compareTo(Attributes other) {
      if (other == this) {
         return 0;
      } else if (this.mask != other.mask) {
         return this.mask < other.mask ? -1 : 1;
      } else {
         this.sort();
         other.sort();

         for (int i = 0; i < this.attributes.size; i++) {
            int c = ((Attribute)this.attributes.get(i)).compareTo(other.attributes.get(i));
            if (c != 0) {
               return c < 0 ? -1 : (c > 0 ? 1 : 0);
            }
         }

         return 0;
      }
   }
}
